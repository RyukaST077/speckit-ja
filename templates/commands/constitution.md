---
description: 対話または指定された原則入力に基づき、プロジェクト憲章を作成・更新し、依存テンプレートとの整合を維持します。
---

## ユーザー入力

```text
$ARGUMENTS
```

入力がある場合は必ず考慮した上で処理を進めてください。

## アウトライン

操作対象は `/memory/constitution.md` にあるプロジェクト憲章テンプレートです。テンプレートには `[PROJECT_NAME]` や `[PRINCIPLE_1_NAME]` のような角括弧付きプレースホルダーが含まれています。あなたの役割は (a) 具体的な値を収集/導出し、(b) テンプレートへ正確に埋め込み、(c) 変更内容を関連成果物へ反映することです。

実行フロー:

1. `/memory/constitution.md` にある既存テンプレートを読み込みます。
   - `[ALL_CAPS_IDENTIFIER]` 形式のすべてのプレースホルダーを特定します。
   - ユーザーが原則数などを指定した場合は必ずそれに従って構成を調整します。

2. プレースホルダーの値を収集/導出します:
   - ユーザー入力に値が含まれていればそれを採用します。
   - それ以外はリポジトリ内のコンテキスト (README、ドキュメント、埋め込み済みの旧版憲章など) から推定します。
   - ガバナンス日付:
     * `RATIFICATION_DATE`: オリジナル採択日 (不明なら質問、困難なら TODO 表記)
     * `LAST_AMENDED_DATE`: 変更を行うなら今日の日付、変更なしなら従来値を維持
   - `CONSTITUTION_VERSION` はセマンティックバージョニングで増分します:
     * MAJOR: 後方互換性のない原則削除・再定義
     * MINOR: 新しい原則/セクション追加、もしくは指針の大幅拡張
     * PATCH: 明確化、文言修正、誤記訂正など意味的影響なし
   - バージョンアップの種別が曖昧な場合は理由を提示してから決定してください。

3. 更新済み憲章を下書きします:
   - すべてのプレースホルダーを具体的な文面に置き換えます (意図的に残す場合は明示的な理由を記載)。
   - 見出し階層を保持し、コメントは役目を終えたら削除して構いません。
   - 各原則セクションでは簡潔な名称、非交渉のルール、必要な場合は理由を明記します。
   - ガバナンスセクションには改訂手続き、バージョン方針、遵守レビューの期待値を含めます。

4. 整合性伝播チェックリスト (以前のチェックリストを実動検証に変換):
   - `templates/plan-template.md` を読み込み、憲章チェックやルールが更新後の原則と一致するか確認/更新
   - `templates/spec-template.md` を確認し、憲章が追加/削除した必須セクションや制約が反映されているか更新
   - `templates/tasks-template.md` を確認し、タスクカテゴリが新たな原則 (例: 可観測性、バージョニング、テスト規律) を反映しているか更新
   - `/templates/commands/*.md` (このファイルを含む) を読み、特定エージェント参照などが時代遅れになっていないか確認し必要なら修正
   - 実行時ガイダンス文書 (例: `README.md`, `docs/quickstart.md`, エージェント固有ガイド) を確認し、変更済み原則の参照が整合しているか更新

5. 同期影響レポートを作成し、更新後の憲章ファイル冒頭に HTML コメントとして追加します:
   - バージョン変更: 旧 → 新
   - 変更した原則 (旧タイトル → 新タイトル)
   - 追加したセクション
   - 削除したセクション
   - 更新したテンプレート一覧 (✅ 更新済み / ⚠ 未実施) とファイルパス
   - 保留した TODO があれば記載

6. 最終検証:
   - 理由なく残った角括弧プレースホルダーがないこと
   - バージョン行がレポートと一致すること
   - 日付は `YYYY-MM-DD` 形式であること
   - 原則は宣言的・検証可能で、曖昧な言い回しを避ける (「should」は適切な rationale とともに)

7. 完成した憲章を `/memory/constitution.md` へ書き込みます (上書き)。

8. 最終サマリーとしてユーザーへ報告:
   - 新しいバージョン番号と増分理由
   - 手動フォローアップが必要なファイル
   - 推奨コミットメッセージ (例: `docs: amend constitution to vX.Y.Z (principle additions + governance update)`)

スタイルとフォーマット要件:
- テンプレートの見出しレベルをそのまま使用
- 行は 100 文字程度を目安に折り返しつつ無理な改行は避ける
- セクション間は 1 行の空行を挿入
- 末尾の空白は避ける

ユーザーが一部の更新のみを指定した場合も、検証とバージョン判断プロセスを必ず実施してください。

重要情報が欠けている場合 (例: 採択日が不明瞭) は `TODO(<FIELD_NAME>): 説明` の形式で記載し、同期影響レポートにも保留項目として追加します。

新しいテンプレートを作成してはいけません。常に既存の `/memory/constitution.md` を更新してください。
