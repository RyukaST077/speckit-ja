---
description: 利用可能な設計成果物に基づいて、実行可能で依存関係順に並べた tasks.md を生成します。
scripts:
  sh: scripts/bash/check-prerequisites.sh --json
  ps: scripts/powershell/check-prerequisites.ps1 -Json
---

## ユーザー入力

```text
$ARGUMENTS
```

入力がある場合は必ず考慮した上で処理を進めてください。

## アウトライン

1. **セットアップ**: リポジトリルートで `{SCRIPT}` を実行し、FEATURE_DIR と AVAILABLE_DOCS を取得します。パスはすべて絶対。`"I'm Groot"` のような引数は `'I'\''m Groot'` または `"I'm Groot"` とエスケープしてください。

2. **設計ドキュメントの読み込み**: FEATURE_DIR から以下を参照:
   - **必須**: plan.md (技術スタック、ライブラリ、構造)、spec.md (優先度付きユーザーストーリー)
   - **任意**: data-model.md (エンティティ)、contracts/ (API エンドポイント)、research.md (判断と根拠)、quickstart.md (テストシナリオ)
   - すべてのプロジェクトで全成果物が揃っているとは限らない点に留意

3. **タスク生成ワークフロー** (テンプレート構造に従う):
   - plan.md から技術スタック・ライブラリ・プロジェクト構造を抽出
   - spec.md から優先度付きユーザーストーリーを抽出
   - data-model.md があればエンティティをストーリーへマッピング
   - contracts/ があれば各エンドポイントを対応するストーリーへ紐づけ
   - research.md があれば決定事項をセットアップタスクへ転換
   - **ユーザーストーリー単位**でタスクを生成:
     - 共通インフラは Setup
     - ブロッキング要素は Foundational
     - 各ユーザーストーリー (優先度順) ごとにタスクをグルーピング
     - テストは明示的に要求された場合のみ生成
     - ファイルが異なれば [P] を付与して並列可能に
     - 同一ファイルを扱う場合は [P] なし
   - タスク ID は T001 から順番に採番
   - ユーザーストーリーごとの独立した実装/検証が可能であることを保証

4. **tasks.md の生成**: `.specify/templates/tasks-template.md` の構成を用い、以下を含める:
   - plan.md から取得したフィーチャー名
   - フェーズ 1: Setup (プロジェクト初期化)
   - フェーズ 2: Foundational (ユーザーストーリー前提の基盤)
   - フェーズ 3 以降: 優先度順にユーザーストーリーごとのフェーズ
     - 各フェーズにストーリーの目標、独立テスト条件、テストタスク (要求された場合)、実装タスクを記載
     - タスク説明に [Story] ラベル (US1 等) を付与
     - 並列可能タスクには [P]
     - 各ストーリー終了時にチェックポイントを明示
   - 最終フェーズ: Polish & Cross-Cutting Concerns
   - 依存関係セクションでストーリー完了順序を明記
   - 各ストーリーの並列実行例を提示
   - 実装戦略 (MVP 優先、段階的提供、並列チーム戦略)

5. **レポート**: 生成した tasks.md のパス、タスク総数、ユーザーストーリーごとのタスク数、並列実行機会、各ストーリーの独立テスト条件、推奨 MVP 範囲 (通常は US1) を出力。

タスク生成の背景: {ARGS}

## ルール要約

- **テストは任意**: ユーザーまたは仕様書で明示されない限りテストタスクは追加しない
- **ユーザーストーリー単位で編成**: 独立した実装・テストが可能であることが最重要
- **契約**: 各エンドポイントを該当ストーリーに紐づけ、テスト要求があれば契約テストを追加
- **データモデル**: エンティティは対応ストーリーに配置 (複数ストーリーで共有する場合は最初の必要箇所または Setup)
- **セットアップ & 基盤**: 共通インフラは Setup、ストーリー前提として必要なものは Foundational に配置
- **順序**:
  - フェーズ 1: Setup
  - フェーズ 2: Foundational
  - フェーズ 3 以降: ユーザーストーリー (優先度順)
  - 最終フェーズ: Polish & Cross-Cutting
  - ストーリー内は「テスト (任意) → モデル → サービス → エンドポイント → 統合」の順

最終的な tasks.md は、そのまま実行できる具体的なタスクレベルで構成されている必要があります。
